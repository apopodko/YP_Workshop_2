# YP_Workshop_2

## Описание проекта
**Заказчик**
Отдел маркетинга интернет-магазина


**Входные данные**
Псевдо-реальные данные об истории покупок покупателей и рекламных рассылок


**Задача**
Необходимо исследовать данные заказчика, сконструировать дополнительные признаки и создать модель для классификации пользователей, основываясь на метрике ROC-AUC


**Цель**
Предсказать вероятность покупки в течение 90 дней


## Входные данные
- **`apparel-purchases.csv`** - данные о покупках клиентов по дням и по товарам
    - `client_id` - идентификатор клиента
    - `quantity` - количество единиц товара
    - `price` - цена товара
    - `category_ids` - идентификаторы категорий
    - `date` - дата покупки
    - `message_id` - идентификатор сообщения из рассылки
    
    
- **`apparel-messages.csv`** - рассылки, которые были отправлены клиентам из таблицы покупок
    - `bulk_campaign_id` - идентификатор рассылки
    - `client_id` - идентификатор клиента
    - `message_id` - идентификатор сообщения
    - `event` - действие с сообщением (отправлено, открыто, покупка…)
    - `channel` - канал рассылки
    - `date` - дата действия
    - `created_at` - дата-время полностью
    
    
- **`apparel-target_binary.csv`** - совершит ли клиент покупку в течение следующих 90 дней
    - `client_id` - идентификатор пользователя
    - `target` - целевой признак

 ## Сконструированные признаки
 - **`data_purchases`**
    - `total_spend` - сколько всего потратил
    - `total_purch` - сколько совершил покупок
    - `med_purch_price` - медианная стоимость покупки
    - `fav_cat_3` - любимая категория из третьего уровня
    - `days_total_purch` - сколько дней пользователь совершал покупки
    - `days_since_last_purch` - количество дней с последней покупки
    - `active_purch_days` - количество дней с покупками
    - `av_days_between_purch` - количество дней между покупками
    
    
- **`data_messages`**
    - `subscribtion` - `subscribe - unsubscribe` - подписки/отписки
    - `open_rate` - `open` / `send` - может много раз открывать рассылку
    - `click_rate` - `click` / `send` - может кликать много раз или наоборот пропускать
    - `mobile_push_count` - сколько сообщений получил через `mobile_push`
    - `email_count` - сколько через `email`
    - `main_campaign` - основная кампания рассылки
 
![image](https://github.com/user-attachments/assets/b82d1d0a-f22f-4a79-b906-9a0f0cc22529)
![image](https://github.com/user-attachments/assets/2dc568d5-46a5-459f-8855-afc563198bec)


 
  ## Модель
- С помощью оптимизационного поиска HyperOpt и кроссвалидацией с 2 фолдами подобрали гиперпараметры для LGBMClassifier:
    - `feature_fraction` = 0.51
    - `learning_rate` = 0.002
    - `max_depth` = 2
    - `n_estimators` = 2000
    - `reg_lambda` = 3.31
    - `scale_pos_weight` = 51

- Рамзер тестовой выборки - 0.2

  
- В результате на тестовой выборке получилась следующая метрики:
    - `ROC-AUC` - 0.759
    - `Weigthed Recall` - 0.609
    - `Weighted F1 score` - 0.844
![image](https://github.com/user-attachments/assets/2f5eae18-e4df-4d3b-955a-38b0159b3347)


- Для более прикладного результата выбрали порог 0.7 для классификатора, чтобы около 10% клиентов, на которых заказчик направил усилия совершили покупку. В результате получаются следующие метрики:
    - `ROC-AUC` - 0.759
    - `Weigthed Recall` - 0.292
    - `Weighted F1 score` - 0.951
![image](https://github.com/user-attachments/assets/d51daa61-2633-4ce4-9b98-694c30170887)
    
    
- Наиоблее важными признаками для модели являются:
    - `click_rate` - с ростом кликов растет вероятность покупки
    - `days_since_last_purch` - чем меньше дней с последней покупки, тем вероятнее покупка
    - `fav_cat_3` - топ-50 категорий из 3 уровня
    - `open_rate` - с ростом открытий рассылок растет вероятность покупки
    - `med_purch_price` - чем меньше медианная цена товаров, которые покупал клиент, тем вероятнее еще раз совершит покупку
    - `main_campaign`- маркетинговая кампания
    - `email_count` и `mobile_push_count` - лучше рассылать больше пушей, чем эл.писем
    - `subscription` - пользователи с отпиской или без менее вероятно что-то купят
